<!DOCTYPE html>
<html lang="en" class="bg-amber-50 text-black">
<head>
    <meta charset="UTF-8">
    <title>Kael POS Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally */
        body {
            font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6 antialiased">

    <div class="max-w-md w-full bg-white border-4 border-black p-8 md:p-10 shadow-[8px_8px_0_0_#000]">
        <h1 class="text-3xl md:text-4xl font-extrabold mb-6 text-black flex items-center gap-3">
            <span class="text-3xl">üßæ</span> Kael POS Login
        </h1>
        <form id="loginForm" class="flex flex-col gap-5">
            <div>
                <label for="username" class="block text-sm font-bold mb-1 text-gray-700">Username</label>
                <input
                    id="username"
                    name="username"
                    placeholder="Enter your username"
                    class="w-full border-2 border-black px-4 py-3 font-medium focus:outline-none focus:ring-4 focus:ring-offset-0 focus:ring-lime-400 transition-shadow duration-150"
                    required
                />
            </div>
            <div>
                <label for="password" class="block text-sm font-bold mb-1 text-gray-700">Password</label>
                <input
                    id="password"
                    name="password"
                    placeholder="Enter your password"
                    type="password"
                    class="w-full border-2 border-black px-4 py-3 font-medium focus:outline-none focus:ring-4 focus:ring-offset-0 focus:ring-lime-400 transition-shadow duration-150"
                    required
                />
            </div>
            <button
                type="submit"
                class="w-full mt-2 bg-lime-400 text-black font-bold py-3 px-6 border-4 border-black shadow-[4px_4px_0_0_#000] hover:bg-lime-300 hover:shadow-[6px_6px_0_0_#000] active:shadow-[2px_2px_0_0_#000] active:translate-x-[2px] active:translate-y-[2px] transition-all duration-150 text-center text-lg">
                Login &rarr;
            </button>
        </form>

        <div id="result" class="mt-5 text-sm font-bold h-5">
             </div>

        <div class="mt-6 border-t-4 border-black pt-5">
            <a href="/index.html" class="group flex items-center justify-center gap-2 text-center text-black font-bold py-2 hover:text-lime-600 transition-colors duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" class="transition-transform duration-150 group-hover:-translate-x-1">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back to Landing Page
            </a>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById("loginForm");
        const resultDiv = document.getElementById("result");

        loginForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            resultDiv.innerText = ""; // Clear previous result
            resultDiv.classList.remove('text-red-600'); // Clear error color

            try {
                const res = await fetch("/auth/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        username: e.target.username.value,
                        password: e.target.password.value
                    })
                });

                // Check if response is JSON before parsing
                const contentType = res.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    const data = await res.json(); // Or handle text response if API sends plain text on error

                     if (res.ok) {
                        // Store login status
                        sessionStorage.setItem('isLoggedIn', 'true');
                         // Optionally add success message before redirect
                         resultDiv.innerText = "‚úÖ Login successful! Redirecting...";
                         resultDiv.classList.add('text-green-600');
                        window.location.href = "/order.html"; // Redirect after successful login
                    } else {
                        // Use error message from API if available, otherwise generic
                        resultDiv.innerText = `‚ùå Login failed! ${data.message || 'Please check credentials.'}`;
                        resultDiv.classList.add('text-red-600');
                    }
                } else {
                     // Handle non-JSON responses (e.g., HTML error pages from server)
                     const textResponse = await res.text();
                     resultDiv.innerText = `‚ùå Login failed! Server returned an error (Status: ${res.status}).`;
                     console.error("Non-JSON response:", textResponse);
                     resultDiv.classList.add('text-red-600');
                }

            } catch (error) {
                 console.error("Login Fetch Error:", error);
                 resultDiv.innerText = "‚ùå An error occurred during login. Please try again.";
                 resultDiv.classList.add('text-red-600');
            }
        });
    </script>
</body>
</html>